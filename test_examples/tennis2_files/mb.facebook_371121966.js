!function(){if(!window.mbfb){window.fbAsyncInit=function(){b.fbAsyncInit_done()};var a={currentUser:null,currentUserMBClientID:null,authorizedPermissions:[],reCacheUserData:function(){a.currentUser=a.currentUserMBClientID=null,authorizedPermissions=[],b.getFBUserInfo(),b.getMBClientID(),b.checkFBPermissions("",function(b){b=implementationSwitchIsEnabled("RI_397355_FacebookApiUpgrade")?b.data:b[0],$.each(a.permissions||[],function(c){"1"==b[a.permissions[c]]&&a.authorizedPermissions.push(a.permissions[c])})})},clearCachedData:function(){currentUser=currentUserMBClientID=null,authorizedPermissions=[]},updateFBAccessToken:function(b,c){if(!b||!c||"s3"!=a.lastKnownLoginStatus)throw"should not call updateFBAccessToken when no FBID or AccessToken is available, or when user is not logged infbid = "+b+" // accesstoken = "+c+" // lastknownLoginStatus = "+a.lastKnownLoginStatus;$.ajax({type:"POST",url:"/FacebookConnect/UpdateFBAccessToken",dataType:"json",data:{fbid:b,fbAccessToken:c},success:function(a){a.Updated}})},lastKnownLoginStatus:null,statusChangeFuncs:[],permissions:null,onFBAsyncInitLoadCallbacks:new $.Deferred};$.mergeMapToArray=function(a,b){return $.each(b,function(b,c){b in a?"array"==typeof a[b]?a[b].push(c):a[b]=[a[b],c]:a[b]=[c]}),a},function(){var a;setTimeout(function(){clearInterval(a)},6e5),a=setInterval(function(){FB.getLoginStatus(),b.getFBID()},3e4)}();var b=window.mbfb={ready:function(b){a.onFBAsyncInitLoadCallbacks.then(b)},fbAsyncInit_done:function(){a.onFBAsyncInitLoadCallbacks.resolve()},init:function(c){if(!b.isInitialized){var d="243187455697579";"mbodev.me"==document.domain.split(".").slice(-2).join(".")&&(d="130024250382012"),window.implementationSwitchIsEnabled("CCG_FacebookUpgradeToV28")?FB.init({appId:d,version:window.facebookGraphVersion,status:!0,cookie:!0,xfbml:!0,oauth:!0}):implementationSwitchIsEnabled("RI_397355_FacebookApiUpgrade")?FB.init({appId:d,version:"v2.7",status:!0,cookie:!0,xfbml:!0,oauth:!0}):FB.init({appId:d,version:"v2.2",status:!0,cookie:!0,xfbml:!0,oauth:!0})}b.isInitialized=!0,c&&(c.onStatusChange&&(a.statusChangeFuncs=$.mergeMapToArray(a.statusChangeFuncs||{},c.onStatusChange)),c.permissions&&($.each(c.permissions,function(a,b){c.permissions[a]=$.trim(c.permissions[a])}),a.permissions=$.merge(a.permissions||[],c.permissions)));var e=c&&c.onInit||void 0;FB.getLoginStatus(function(c){var d="connected"==c.status?"s3":"not connected"==c.status||"notConnected"==c.status||"not_authorized"==c.status?"s2":"s1";a.lastKnownLoginStatus=d,"s3"==d&&a.reCacheUserData(),e&&e[d]&&e[d](c),a.statusChangeFuncs&&FB.Event.subscribe("auth.authResponseChange",function(c){var d=a.lastKnownLoginStatus,e=a.lastKnownLoginStatus="connected"==c.status?"s3":"not connected"==c.status||"notConnected"==c.status||"not_authorized"==c.status?"s2":"s1";"s3"==e?(a.updateFBAccessToken(b.getFBID(),b.getFBAccessToken()),a.reCacheUserData()):a.clearCachedData(),a.statusChangeFuncs[d+"_to_"+e]?$.each(a.statusChangeFuncs[d+"_to_"+e],function(a,b){b(c)}):a.statusChangeFuncs[e]&&$.each(a.statusChangeFuncs[e],function(a,b){"function"==typeof b&&b(c)})})})},addStatusChangeFuncs:function(b){a.statusChangeFuncs=$.mergeMapToArray(a.statusChangeFuncs||{},b)},removeStatusChangeFuncs:function(){a.statusChangeFuncs=null},isFBConnected:function(){return"s3"==a.lastKnownLoginStatus},checkFBPermissions:function(b,c){if(implementationSwitchIsEnabled("RI_397355_FacebookApiUpgrade"))FB.api("/me/permissions",function(a){c&&c(a)});else{var d=$.merge(b||[],a.permissions||[]).join(","),e="SELECT "+d+" FROM permissions WHERE uid=me()";FB.api({method:"fql.query",query:e},function(a){c&&c(a)})}},tryLoginAndConnect:function(c){if(this.isFBConnected()&&b.hasAuthorizedAllPermissions())return void c.success();FB.login(function(a){"connected"==a.status?c.success():c.fail&&c.fail()},{scope:a.permissions&&a.permissions.join(",")||""})},logOutOfFacebook:function(b){a.clearCachedData(),FB.logout(b||function(){}),showGenericLogin()},getFBUserInfo:function(b){"s3"==a.lastKnownLoginStatus&&a.currentUser&&b?b(a.currentUser):implementationSwitchIsEnabled("RI_397355_FacebookApiUpgrade")?FB.api("/me?fields=id,name,first_name",function(c){a.currentUser=c,b&&b(c)}):FB.api("/me",function(c){a.currentUser=c,b&&b(c)})},doStreamPost:function(a){FB.api("/me/feed","post",a)},getFBAccessToken:function(){var a=FB.getAuthResponse();return a&&a.accessToken||null},getFBID:function(){var a=FB.getAuthResponse();return a&&a.userID||null},getFBLoginStatus:function(){return a.lastKnownLoginStatus},getFBUserImage:function(){var a=b.getFBID();if(!a)return null;var c="";return FB.api("/"+a+"/picture",function(a){a&&!a.error&&(c=a.data.url,c.length>0&&$(".facebookProfileImage").attr("src",c))}),$('<img class="facebookProfileImage" src="'+c+'" />')[0]},isMBSiteConnected:function(a){b.getMBClientID(function(b){b&&a&&a.yes?a.yes():a&&a.no&&a.no()})},hasAuthorizedAllPermissions:function(){return!0},getMBClientID:function(c){if(a.currentUserMBClientID)return void(c&&c(a.currentUserMBClientID));var d=b.getFBID(),e=b.getFBAccessToken();if(!d||!e)return c&&c(response.ClientID)||null;$.ajax({url:"/FacebookConnect/IsFBUserConnected",type:"POST",data:{fbid:d,fbAccessToken:e},dataType:"json",success:function(b){b.SiteConnected?(a.currentUserMBClientID=b.ClientID,c&&c(b.ClientID)):(a.currentUserMBClientID=null,c&&c(b.ClientID))}})}}}}();