jQuery&&function(a){a.extend(a.fn,{selectBox:function(b,c){var d,e="",f=function(b,c){if(navigator.userAgent.match(/iPad|iPhone/i))return!1;if("select"!==b.tagName.toLowerCase())return!1;if(b=a(b),b.data("selectBox-control"))return!1;var d=a('<a class="selectBox" />'),e=b.prop("multiple")||parseInt(b.attr("size"))>1,f=c||{};if(d.addClass(b.attr("class")).attr("style",b.attr("style")||"").attr("title",b.attr("title")||"").attr("tabindex",parseInt(b.attr("tabindex"))).css("display","inline-block").bind("focus.selectBox",function(){this!==document.activeElement&&a(document.activeElement).blur(),d.hasClass("selectBox-active")||(d.addClass("selectBox-active"),b.trigger("focus"))}).bind("blur.selectBox",function(){d.hasClass("selectBox-active")&&(d.removeClass("selectBox-active"),b.trigger("blur"))}),b.is(":disabled")&&d.addClass("selectBox-disabled"),e){var h=g(b,"inline");if(d.append(h).data("selectBox-options",h).addClass("selectBox-inline").addClass("selectBox-menuShowing").bind("keydown.selectBox",function(a){o(b,a)}).bind("keypress.selectBox",function(a){p(b,a)}).bind("mousedown.selectBox",function(b){a(b.target).is("A.selectBox-inline")&&b.preventDefault(),d.hasClass("selectBox-focus")||d.focus()}).insertAfter(b),!b[0].style.height){var k=b.attr("size")?parseInt(b.attr("size")):5,l=d.clone().removeAttr("id").css({position:"absolute",top:"-9999em"}).show().appendTo("body");l.find(".selectBox-options").html("<li><a> </a></li>"),optionHeight=parseInt(l.find(".selectBox-options A:first").html("&nbsp;").outerHeight()),l.remove(),d.height(optionHeight*k)}u(d)}else{var m=a('<span class="selectBox-label" />'),n=a('<span class="selectBox-arrow">&nbsp;</span>');m.text(a(b).find("OPTION:selected").text()||" ");var h=g(b,"dropdown");if(f.fixed&&h.css({position:"fixed"}),h.appendTo("BODY"),d.data("selectBox-options",h).addClass("selectBox-dropdown").append(m).append(n).bind("mousedown.selectBox-label",function(a){d.hasClass("selectBox-menuShowing")?j():(a.stopPropagation(),h.data("selectBox-down-at-x",a.screenX).data("selectBox-down-at-y",a.screenY),i(b))}).bind("keydown.selectBox",function(a){o(b,a)}).bind("keypress.selectBox",function(a){p(b,a)}).insertAfter(b),u(d),f.useCssWidth)var q=d.width();else{var q=h.outerWidth()-d.outerWidth()+d.width();q>d.width()&&d.width(q)}}b.addClass("selectBox").data("selectBox-control",d).data("selectBox-settings",f).hide()},g=function(b,c){var d,e=124;switch(c){case"inline":return d=a('<ul class="selectBox-options" />'),b.find("OPTGROUP").length?b.find("OPTGROUP").each(function(){var b=a('<li class="selectBox-optgroup" />');b.text(a(this).attr("label")),d.append(b),a(this).find("OPTION").each(function(){var b=a("<li />"),c=a("<a />");if(b.addClass(a(this).attr("class")),c.attr("rel",a(this).val()).text(a(this).text()),b.append(c),a(this).data("thumbnail")&&(d.hasClass("thumbnail")||d.addClass("thumbnail"),b.prepend('<div class="thumbnailContainer"><img src="'+a(this).data("thumbnail")+'"/></div>')),a(this).data("aside")&&b.append('<span class="aside">'+a(this).data("aside")+"</span>"),a(this).data("message")){var f=a(this).data("message");f.length>e&&(f=f.substring(0,e-3)+"..."),b.append('<span class="aTipsy" title="'+a(this).data("message")+'">'+f+"</span>")}a(this).prop("disabled")&&b.addClass("selectBox-disabled"),a(this).prop("selected")&&b.addClass("selectBox-selected"),a(this).attr("title")&&b.attr("title",a(this).attr("title")),d.append(b)})}):b.find("OPTION").each(function(){var b=a("<li />"),c=a("<a />");if(b.addClass(a(this).attr("class")),c.attr("rel",a(this).val()).text(a(this).text()),b.append(c),a(this).data("thumbnail")&&(d.hasClass("thumbnail")||d.addClass("thumbnail"),b.prepend('<div class="thumbnailContainer"><img src="'+a(this).data("thumbnail")+'"/></div>')),a(this).data("aside")&&b.append('<span class="aside">'+a(this).data("aside")+"</span>"),a(this).data("message")){var f=a(this).data("message");f.length>e&&(f=f.substring(0,e-3)+"..."),b.append('<span class="aTipsy" title="'+a(this).data("message")+'">'+f+"</span>")}a(this).prop("disabled")&&b.addClass("selectBox-disabled"),a(this).prop("selected")&&b.addClass("selectBox-selected"),a(this).attr("title")&&b.attr("title",a(this).attr("title")),d.append(b)}),d.find("LI").children().bind("mouseover.selectBox",function(c){l(b,a(this).parent())}).bind("mouseout.selectBox",function(c){m(b,a(this).parent())}).bind("mousedown.selectBox",function(a){a.preventDefault(),b.selectBox("control").hasClass("selectBox-active")||b.selectBox("control").focus()}),d.find("LI").bind("mouseup.selectBox",function(c){j(),k(b,a(this),c)}),u(d),d;case"dropdown":return d=a('<ul class="selectBox-dropdown-menu selectBox-options" />'),b.find("OPTGROUP").length?b.find("OPTGROUP").each(function(){var b=a('<li class="selectBox-optgroup" />');b.text(a(this).attr("label")),d.append(b),a(this).find("OPTION").each(function(){var b=a("<li />"),c=a("<a />");if(b.addClass(a(this).attr("class")),c.attr("rel",a(this).val()).text(a(this).text()),b.append(c),a(this).data("thumbnail")&&(d.hasClass("thumbnail")||d.addClass("thumbnail"),b.prepend('<div class="thumbnailContainer"><img src="'+a(this).data("thumbnail")+'"/></div>')),a(this).data("aside")&&b.append('<span class="aside">'+a(this).data("aside")+"</span>"),a(this).data("message")){var f=a(this).data("message");f.length>e&&(f=f.substring(0,e-3)+"..."),b.append('<span class="aTipsy" title="'+a(this).data("message")+'">'+f+"</span>")}a(this).prop("disabled")&&b.addClass("selectBox-disabled"),a(this).prop("selected")&&b.addClass("selectBox-selected"),a(this).attr("title")&&b.attr("title",a(this).attr("title")),d.append(b)})}):b.find("OPTION").length>0?b.find("OPTION").each(function(){var b=a("<li />"),c=a("<a />");if(b.addClass(a(this).attr("class")),c.attr("rel",a(this).val()).text(a(this).text()),b.append(c),a(this).data("thumbnail")&&(d.hasClass("thumbnail")||d.addClass("thumbnail"),b.prepend('<div class="thumbnailContainer"><img src="'+a(this).data("thumbnail")+'"/></div>')),a(this).data("aside")&&b.append('<span class="aside">'+a(this).data("aside")+"</span>"),a(this).data("message")){var f=a(this).data("message");f.length>e&&(f=f.substring(0,e-3)+"..."),b.append('<span class="aTipsy" title="'+a(this).data("message")+'">'+f+"</span>")}a(this).prop("disabled")&&b.addClass("selectBox-disabled"),a(this).prop("selected")&&b.addClass("selectBox-selected"),a(this).attr("title")&&b.attr("title",a(this).attr("title")),d.append(b)}):d.append("<li> </li>"),d.data("selectBox-select",b).css("display","none").appendTo("BODY").find("LI").children().bind("mouseover.selectBox",function(c){l(b,a(this).parent())}).bind("mouseout.selectBox",function(c){m(b,a(this).parent())}),d.find("LI").bind("mousedown.selectBox",function(a){a.preventDefault(),a.screenX===d.data("selectBox-down-at-x")&&a.screenY===d.data("selectBox-down-at-y")&&(d.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y"),j())}).bind("mouseup.selectBox",function(c){c.screenX===d.data("selectBox-down-at-x")&&c.screenY===d.data("selectBox-down-at-y")||(d.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y"),k(b,a(this)),j())}),u(d),d}},h=function(b){b=a(b);var c=b.data("selectBox-control");if(c){c.data("selectBox-options").remove(),c.remove(),b.removeClass("selectBox").removeData("selectBox-control").removeData("selectBox-settings").show()}},i=function(b){b=a(b);var c=b.data("selectBox-control"),d=b.data("selectBox-settings"),e=c.data("selectBox-options");if(c.hasClass("selectBox-disabled"))return!1;switch(j(),d.useCssWidth?e.css({top:c.offset().top-a(window).scrollTop()+c.outerHeight()-parseInt(c.css("borderBottomWidth")),left:c.offset().left-(e.outerWidth()-c.outerWidth())}):e.css({width:c.outerWidth()-(parseInt(c.css("borderLeftWidth"))+parseInt(c.css("borderLeftWidth"))),top:c.offset().top-a(window).scrollTop()+c.outerHeight()-parseInt(c.css("borderBottomWidth")),left:c.offset().left}),e.outerWidth()<c.outerWidth()&&e.css({width:c.outerWidth()-(parseInt(c.css("borderLeftWidth"))+parseInt(c.css("borderLeftWidth"))),top:c.offset().top-a(window).scrollTop()+c.outerHeight()-parseInt(c.css("borderBottomWidth")),left:c.offset().left}),d.menuTransition){case"fade":e.fadeIn(d.menuSpeed);break;case"slide":e.slideDown(d.menuSpeed);break;default:e.show(d.menuSpeed)}var f=e.find(".selectBox-selected:first");n(b,f,!0),l(b,f),c.addClass("selectBox-menuShowing"),a(document).bind("mousedown.selectBox",function(b){a(b.target).parents().andSelf().hasClass("selectBox-options")||j()})},j=function(){0!==a(".selectBox-dropdown-menu").length&&(a(document).unbind("mousedown.selectBox"),a(".selectBox-dropdown-menu").each(function(){var b=a(this),c=b.data("selectBox-select"),d=c.data("selectBox-control"),e=c.data("selectBox-settings");switch(e.menuTransition){case"fade":b.fadeOut(e.menuSpeed);break;case"slide":b.slideUp(e.menuSpeed);break;default:b.hide(e.menuSpeed)}d.removeClass("selectBox-menuShowing")}))},k=function(b,c,d){b=a(b),c=a(c);var e=b.data("selectBox-control");b.data("selectBox-settings");if(e.hasClass("selectBox-disabled"))return!1;if(0===c.length||c.hasClass("selectBox-disabled"))return!1;if(b.prop("multiple"))if(d.shiftKey&&e.data("selectBox-last-selected")){c.toggleClass("selectBox-selected");var f;f=c.index()>e.data("selectBox-last-selected").index()?c.siblings().slice(e.data("selectBox-last-selected").index(),c.index()):c.siblings().slice(c.index(),e.data("selectBox-last-selected").index()),f=f.not(".selectBox-optgroup, .selectBox-disabled"),c.hasClass("selectBox-selected")?f.addClass("selectBox-selected"):f.removeClass("selectBox-selected")}else d.metaKey?c.toggleClass("selectBox-selected"):(c.siblings().removeClass("selectBox-selected"),c.addClass("selectBox-selected"));else c.siblings().removeClass("selectBox-selected"),c.addClass("selectBox-selected");e.hasClass("selectBox-dropdown")&&e.find(".selectBox-label").text(c.children("a").text());var g=0,h=[];return b.prop("multiple")?e.find(".selectBox-selected A").each(function(){h[g++]=a(this).attr("rel")}):h=c.find("A").attr("rel"),e.data("selectBox-last-selected",c),b.val()!==h&&(b.val(h),b.trigger("change")),!0},l=function(b,c){b=a(b),c=a(c),b.data("selectBox-control").data("selectBox-options").find(".selectBox-hover").removeClass("selectBox-hover"),c.addClass("selectBox-hover")},m=function(b,c){b=a(b),c=a(c),b.data("selectBox-control").data("selectBox-options").find(".selectBox-hover").removeClass("selectBox-hover")},n=function(b,c,d){if(c&&0!==c.length){b=a(b);var e=b.data("selectBox-control"),f=e.data("selectBox-options"),g=e.hasClass("selectBox-dropdown")?f:f.parent(),h=parseInt(c.offset().top-g.position().top),i=parseInt(h+c.outerHeight());d?g.scrollTop(c.offset().top-g.offset().top+g.scrollTop()-g.height()/2):(h<0&&g.scrollTop(c.offset().top-g.offset().top+g.scrollTop()),i>g.height()&&g.scrollTop(c.offset().top+c.outerHeight()-g.offset().top+g.scrollTop()-g.height()))}},o=function(b,c){b=a(b);var d=b.data("selectBox-control"),f=d.data("selectBox-options"),g=0,h=0;if(!d.hasClass("selectBox-disabled"))switch(c.keyCode){case 8:c.preventDefault(),e="";break;case 9:case 27:j(),m(b);break;case 13:d.hasClass("selectBox-menuShowing")?(k(b,f.find("LI.selectBox-hover:first"),c),d.hasClass("selectBox-dropdown")&&j()):i(b);break;case 38:case 37:if(c.preventDefault(),d.hasClass("selectBox-menuShowing")){var o=f.find(".selectBox-hover").prev("LI");for(g=f.find("LI:not(.selectBox-optgroup)").length,h=0;(0===o.length||o.hasClass("selectBox-disabled")||o.hasClass("selectBox-optgroup"))&&(o=o.prev("LI"),0===o.length&&(o=f.find("LI:last")),!(++h>=g)););l(b,o),n(b,o)}else i(b);break;case 40:case 39:if(c.preventDefault(),d.hasClass("selectBox-menuShowing")){var p=f.find(".selectBox-hover").next("LI");for(g=f.find("LI:not(.selectBox-optgroup)").length,h=0;(0===p.length||p.hasClass("selectBox-disabled")||p.hasClass("selectBox-optgroup"))&&(p=p.next("LI"),0===p.length&&(p=f.find("LI:first")),!(++h>=g)););l(b,p),n(b,p)}else i(b)}},p=function(b,c){b=a(b);var f=b.data("selectBox-control"),g=f.data("selectBox-options");if(!f.hasClass("selectBox-disabled"))switch(c.keyCode){case 9:case 27:case 13:case 38:case 37:case 40:case 39:break;default:f.hasClass("selectBox-menuShowing")||i(b),c.preventDefault(),clearTimeout(d),e+=String.fromCharCode(c.charCode||c.keyCode),g.find("A").each(function(){if(a(this).text().substr(0,e.length).toLowerCase()===e.toLowerCase())return l(b,a(this).parent()),n(b,a(this).parent()),!1}),d=setTimeout(function(){e=""},1e3)}},q=function(b){b=a(b),b.prop("disabled",!1);var c=b.data("selectBox-control");c&&c.removeClass("selectBox-disabled")},r=function(b){b=a(b),b.prop("disabled",!0);var c=b.data("selectBox-control");c&&c.addClass("selectBox-disabled")},s=function(b,c){b=a(b),b.val(c),c=b.val();var d=b.data("selectBox-control");if(d){var e=b.data("selectBox-settings"),f=d.data("selectBox-options");d.find(".selectBox-label").text(a(b).find("OPTION:selected").text()||" "),f.find(".selectBox-selected").removeClass("selectBox-selected"),f.find("A").each(function(){if("object"==typeof c)for(var b=0;b<c.length;b++)a(this).attr("rel")==c[b]&&a(this).parent().addClass("selectBox-selected");else a(this).attr("rel")==c&&a(this).parent().addClass("selectBox-selected")}),e.change&&e.change.call(b)}},t=function(b,d){b=a(b);var e=b.data("selectBox-control");b.data("selectBox-settings");switch(typeof c){case"string":b.html(c);break;case"object":b.html("");for(var f in c)if(null!==c[f])if("object"==typeof c[f]){var h=a('<optgroup label="'+f+'" />');for(var i in c[f])h.append('<option value="'+i+'">'+c[f][i]+"</option>");b.append(h)}else{var j=a('<option value="'+f+'">'+c[f]+"</option>");b.append(j)}}if(e){e.data("selectBox-options").remove();var k=e.hasClass("selectBox-dropdown")?"dropdown":"inline",d=g(b,k);switch(e.data("selectBox-options",d),k){case"inline":e.append(d);break;case"dropdown":e.find(".selectBox-label").text(a(b).find("OPTION:selected").text()||" "),a("BODY").append(d)}}},u=function(b){a(b).css("MozUserSelect","none").bind("selectstart",function(a){a.preventDefault()})};switch(b){case"control":return a(this).data("selectBox-control");case"settings":if(!c)return a(this).data("selectBox-settings");a(this).each(function(){a(this).data("selectBox-settings",a.extend(!0,a(this).data("selectBox-settings"),c))});break;case"options":a(this).each(function(){t(this,c)});break;case"value":if(!c)return a(this).val();a(this).each(function(){s(this,c)});break;case"enable":a(this).each(function(){q(this)});break;case"disable":a(this).each(function(){r(this)});break;case"destroy":a(this).each(function(){h(this)});break;default:a(this).each(function(){f(this,b)})}return a(this)}})}(jQuery);