function toggleLoginButtonVisibility(a){var b=$("#FacebookAjaxSpinner"),c=$("#FacebookLoginButton");"show"==a?(c.fadeTo("fast",1).css("opacity",null),b.hide()):(c.fadeTo("fast",.6),b.show())}function submitFBLogin(a,b,c,d){var e=$("input[name=optForwardingLink]").val();$('<form method="POST" action="/Login"><input type="hidden" name="fbid" value="'+a+'"/><input type="hidden" name="fbAccessToken" value="'+b+'"/><input type="hidden" name="requiredtxtUserName" value=""/><input type="hidden" name="requiredtxtPassword" value=""/><input type="hidden" name="optForwardingLink" value=""/></form>').find("input[name=requiredtxtUserName]").val(c).end().find("input[name=requiredtxtPassword]").val(d).end().find("input[name=optForwardingLink]").val(e).end().appendTo(document.getElementsByTagName("body")[0]).submit()}function showGenericLogin(){var a=$("#DefaultLogin #FacebookHeader"),b=$("#SpecificMessage",a);$("#SpecificMessage",a).fadeOut("fast",function(){b.hide(),$("#fbHeaderRightContainer").hide(),$("#FacebookLoginButton").css("top","24px"),$("#GenericMessage",a).fadeIn("fast")})}function promptLogin(a,b,c){if(window.bindAmplitudeEvent(),window.logEvent("(CARP Lightbox) - View",{}),navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iP[ao]d/i))return void(document.location=c);void 0!==a&&($("#BookingInfoText1",$loginContent).html(a).show(),$("h2.LoginHeader",$loginContent).css("display","block")),void 0!==b&&($("#BookingInfoText2",$loginContent).html(b).show(),$("h2.LoginHeader",$loginContent).css("display","block")),window.fbForwardingLink=c||"",$("input[name=optForwardingLink]",$loginContent).val(c),$loginContent.lightbox(!1,0,!1,!0),$loginContent=$("#LoginContent"),wireUpSubmitHandlers(),fbHandlers()}function setBookingStringOnly(a,b){void 0!==a&&($("#BookingInfoText1",$loginContent).html(a).show(),$("h2.LoginHeader",$loginContent).css("display","block")),void 0!==b&&($("#BookingInfoText2",$loginContent).html(b).show(),$("h2.LoginHeader",$loginContent).css("display","block"))}function loginSuccess(a){if(a.success){var b=$(document.body),c='<form id="loginSuperForm" method="post" action="'+a.url+'">'+a.buildLinkVars+'<input type="hidden" name="justloggedin" value="true" /></form>';b.append(c),$.libasync.process({url:"/SubscriberBilling/Status",studioID:windowContext.js_studioid,timeout:2e3,callback:function(a){$("#loginSuperForm",b).submit()},error:function(a,c,d){$("#loginSuperForm",b).submit()}})}else $("#btnLogin, #btnSu1Login, #btnFBVerifyLogin").removeClass("loading"),"sessionTimeout"==a.failureReason?windowContext.location="/ASP/logout.asp?studioid="+windowContext.js_studioid:displayLoginFailure(a.failureReason)}function showFailedLoginPrompt(a){var b=$("input[name='requiredtxtUserName'], input[name='requiredtxtPassword']").filter(function(){return $(this).is(":visible")});b.val(""),b.addClass("error"),$errorDiv=$("#LoginError"),-1!=a.indexOf("It looks like you")?$errorDiv.html("string"==typeof a&&a.length>0?a:"Login Error"):$errorDiv.text("string"==typeof a&&a.length>0?a:"Login Error"),$errorDiv.show()}function showFbConfirmFailedLoginPrompt(a){var b=$("input[name='requiredtxtUserName'], input[name='requiredtxtPassword']");b.val(""),b.addClass("error"),$errorDiv=$("#fbLoginError"),-1!=a.indexOf("It looks like you")?$errorDiv.html("string"==typeof a&&a.length>0?a:"Login Error"):$errorDiv.text("string"==typeof a&&a.length>0?a:"Login Error"),$errorDiv.show()}function wireUpSubmitHandlers(){var a="input[type='text'], input[type='password'], input[type='email']",b=$(a,$("#LoginContent"));b.removeClass("error"),$(".LoginErrorDiv").html("").hide(),b.off("keydown.loginContentInputs").on("keydown.loginContentInputs",function(c){$(this).hasClass("error")&&(b=$(a,$("#LoginContent")),b.removeClass("error"),$(".LoginErrorDiv").html("").hide()),13==c.which&&(1==$(this).parents("#ExistingUserPane").size()?$("#btnSu1Login").click():$("#btnNext").click())})}function fbHandlers(){var a=$("#fbPleaseCompleteAllFields").val();$("#PleaseCompleteAllFields").val();ABTestIsEnabled(1043),$.fn.placeholder&&$.fn.unplaceholder&&($("input[placeholder]").unplaceholder(),$("input[placeholder]").placeholder()),$("input[type='text'], input[type='password'], input[type='email']",$("#FacebookConfirmation")).removeClass("error"),$("#fbLoginError").html("").hide();var b=!1,c=function(a,c){if(a instanceof jQuery&&1==a.size()){var d=a.val();return(""==$.trim(d)||d==a.attr("placeholder")||"yes"==a.data("isDummy"))&&(c&&(a.addClass("error"),b=!0),!0)}throw"Must pass single-member jQuery object into function 'isEmpty'"},d=function(a){if("login"!=a)throw"Invalid param for 'strPane' in function doValidate()";if(b=!1,"login"==a){var d=$("#fbExistingUserPane input",$("#FacebookConfirmation")),e=d.filter("#requiredtxtUserName"),f=d.filter(function(){return"yes"==$(this).data("isDummy")});if(f.is(":visible"))b=!0;else{var g=d.filter("#requiredtxtPassword");c(g,!0)}f.addClass("error"),c(e,!0)}return!b};$("#btnFBVerifyLogin").unbind("click"),$("#btnFBVerifyLogin").click(function(b){var c=$(this),e="btnFBVerifyLogin"==c.attr("id");if(!c.hasClass("loading"))if(e&&!d("login"))$("#fbLoginError").text(a).show(),b.preventDefault();else{if(c.addClass("loading"),e){var f=c.parents("form:first");$("input[name=fbid]",f).val(mbfb.getFBID()),$("input[name=fbAccessToken]",f).val(mbfb.getFBAccessToken()),$("input[name=optForwardingLink]",f).val(window.fbForwardingLink)}$.libasync.process({url:"/Login",data:c.parents("form:first").serialize(),callback:loginSuccess,studioID:windowContext.js_studioid,complete:function(a){}}),b.preventDefault()}});var e="input[type='text'], input[type='password'],input[type='email']",f=$(e,$("#FacebookConfirmation"));f.unbind("keydown"),f.keydown(function(a){$(this).hasClass("error")&&(f=$(e,$("#FacebookConfirmation")),f.removeClass("error"),$(".LoginErrorDiv").html("").hide()),13==a.which&&(1==$(this).parents("#fbExistingUserPane").size()?$("#btnFBVerifyLogin").click():$("#btnFBVerifyLoginNext").click())})}var $loginContent,$fbLoginContent,$fbAjaxSpinner,$fbLoginButton,$FacebookConfirmation,$fbVerifyLoginButton,$fbNewUserPane,windowContext=window;$(document).ready(function(){$loginContent=$("#LoginContent"),$fbAjaxSpinner=$("#FacebookAjaxSpinner"),$fbLoginButton=$("#FacebookLoginButton"),$fbLoginContent=$("#FacebookConfirmation"),$FacebookConfirmation=$("#FacebookConfirmation"),$fbVerifyLoginButton=$("#btnFBVerifyLogin"),$fbNewUserPane=$("#fbNewUserPane");var a=!1,b=function(b,c){if(b instanceof jQuery&&1==b.size()){var d=b.val();return(""==$.trim(d)||d==b.attr("placeholder")||"yes"==b.data("isDummy"))&&(c&&(b.addClass("error"),a=!0),!0)}throw"Must pass single-member jQuery object into function 'isEmpty'"};toggleLoginButtonVisibility("show"),"undefined"!=typeof mbfb&&mbfb.ready(function(){$fbLoginButton=$("#FacebookLoginButton"),mbfb.init({onInit:{s1:function(){facebookAutoLoginFromPortal()},s2:function(){facebookAutoLoginFromPortal()},s3:function(){showSpecificLogin(),facebookAutoLoginFromPortal()}},onStatusChange:{s1:showGenericLogin,s2:showGenericLogin,s3:showSpecificLogin},permissions:["email"]}),$fbLoginButton.click(function(){mbfb.tryLoginAndConnect({success:function(){toggleLoginButtonVisibility("fade"),mbfb.getFBUserInfo(function(a){mbfb.isMBSiteConnected({yes:function(){submitFBLogin(mbfb.getFBID(),mbfb.getFBAccessToken(),$("#requiredTxtPassword",$loginContent).val(),$("#requiredTxtUsername",$loginContent).val())},no:function(){var b=mbfb.getFBID(),c=mbfb.getFBAccessToken(),d=a.email;$.ajax({type:"POST",url:"/FacebookConnect/PairIfUniqueEmail",dataType:"json",data:{fbid:b,fbAccessToken:c,EmailName:d},success:function(a){if(a.UserWasConnected)submitFBLogin(b,c,d);else{$loginContent.hasClass("lightbox_centralElement")?(hidelightbox(!0),$fbLoginContent.lightbox(!0,0,!1,!0),toggleLoginButtonVisibility("show"),fbHandlers()):($loginContent.hide(),$fbLoginContent.show()),$(".js-createAccountValidationError .validation-error").remove()}}})}})})},fail:function(){}})}),wireUpSubmitHandlers(),fbHandlers()});var c=function(c){if("login"!=c)throw"Invalid param for 'strPane' in function doValidate()";if(a=!1,"login"==c){var d=$("#ExistingUserPane input",$("#LoginContent")),e=d.filter("#su1UserName"),f=d.filter(function(){return"yes"==$(this).data("isDummy")});if(f.is(":visible"))a=!0;else{var g=d.filter("#su1Password");b(g,!0)}f.addClass("error"),b(e,!0)}return!a},d=$("#PleaseCompleteAllFields").val();$("#btnLogin,#btnSu1Login, #btnFBVerifyLogin").click(function(a){var b=$(this),e="btnSu1Login"==b.attr("id");b.hasClass("loading")||(e&&!c("login")?($("#LoginError").text(d).show(),a.preventDefault()):(b.addClass("loading"),$.libasync.process({url:"/Login",data:b.parents("form:first").serialize(),callback:loginSuccess,studioID:windowContext.js_studioid,complete:function(){}}),a.preventDefault()))});var e=$("#ExistingUsersHeader",$loginContent),f=e.text().length;f>100?e.css("font-size","100%"):f>75?e.css("font-size","115%"):f>45?e.css("font-size","145%"):f>40?e.css("font-size","170%"):f>30&&e.css("font-size","180%"),$FacebookConfirmation=$("#FacebookConfirmation"),$fbVerifyLoginButton=$("#btnFBVerifyLogin"),$fbNewUserPane=$("#fbNewUserPane")}),$(document).ready(function(){$("body").delegate("#LoginContent #CloseButton, #FacebookConfirmation #fbCloseButton","click",function(a){toggleLoginButtonVisibility("show"),hidelightbox(!1,function(){var a=$("input[type=text],input[type=password],input[type=email]",$(".lightbox_centralElement"));$.each(a,function(){var a=$(this);"yes"!=a.data("isDummy")&&(a.val(""),a.focusout()),a.removeClass("error"),a.removeClass("validation-error"),$(".js-bannerError").removeClass("createAccountBannerAlert"),$("#requiredtxtEmail_Address-error").remove(),$(".LoginErrorDiv").html("").hide()})})}),$.fn.placeholder&&$("input[placeholder]").placeholder()});